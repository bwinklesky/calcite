export const __webpack_id__ = "vendors-node_modules_esri_calcite-components_dist_components_calcite-action-menu_index_js";
export const __webpack_ids__ = ["vendors-node_modules_esri_calcite-components_dist_components_calcite-action-menu_index_js"];
export const __webpack_modules__ = {

/***/ "./node_modules/@esri/calcite-components/dist/chunks/array.js":
/*!********************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/chunks/array.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   g: () => (/* binding */ getRoundRobinIndex)
/* harmony export */ });
/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.3.3 */
function getRoundRobinIndex(index, total) {
  return (index + total) % total;
}



/***/ }),

/***/ "./node_modules/@esri/calcite-components/dist/chunks/resources2.js":
/*!*************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/chunks/resources2.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   C: () => (/* binding */ CSS),
/* harmony export */   I: () => (/* binding */ IDS),
/* harmony export */   S: () => (/* binding */ SLOTS),
/* harmony export */   a: () => (/* binding */ ICONS)
/* harmony export */ });
/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.3.3 */
const CSS = {
  menu: "menu",
  defaultTrigger: "default-trigger"
};
const idPrefix = "calcite-action-menu";
const IDS = {
  button: (id) => `${idPrefix}-${id}-menu-button`,
  menu: (id) => `${idPrefix}-${id}-menu`,
  action: (id, actionId) => `${idPrefix}-${id}-action-${actionId}`
};
const SLOTS = {
  tooltip: "tooltip",
  trigger: "trigger"
};
const ICONS = {
  menu: "ellipsis"
};



/***/ }),

/***/ "./node_modules/@esri/calcite-components/dist/components/calcite-action-menu/customElement.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/components/calcite-action-menu/customElement.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ActionMenu: () => (/* binding */ ActionMenu)
/* harmony export */ });
/* harmony import */ var _chunks_runtime_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../chunks/runtime.js */ "./node_modules/@esri/calcite-components/dist/chunks/runtime.js");
/* harmony import */ var lit_directives_ref_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lit/directives/ref.js */ "./node_modules/lit/directives/ref.js");
/* harmony import */ var lit__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lit */ "./node_modules/lit/index.js");
/* harmony import */ var _arcgis_lumina__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @arcgis/lumina */ "./node_modules/@arcgis/lumina/dist/index.js");
/* harmony import */ var _chunks_array_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../chunks/array.js */ "./node_modules/@esri/calcite-components/dist/chunks/array.js");
/* harmony import */ var _chunks_dom_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../chunks/dom.js */ "./node_modules/@esri/calcite-components/dist/chunks/dom.js");
/* harmony import */ var _chunks_guid_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../chunks/guid.js */ "./node_modules/@esri/calcite-components/dist/chunks/guid.js");
/* harmony import */ var _chunks_key_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../chunks/key.js */ "./node_modules/@esri/calcite-components/dist/chunks/key.js");
/* harmony import */ var _chunks_useSetFocus_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../chunks/useSetFocus.js */ "./node_modules/@esri/calcite-components/dist/chunks/useSetFocus.js");
/* harmony import */ var _chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../chunks/resources2.js */ "./node_modules/@esri/calcite-components/dist/chunks/resources2.js");
/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.3.3 */










const styles = (0,lit__WEBPACK_IMPORTED_MODULE_2__.css)`:host{--calcite-internal-color-focus: var( --calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)) )}:host{box-sizing:border-box;display:flex;flex-direction:column;font-size:var(--calcite-font-size-1)}::slotted(calcite-action-group:not(:last-of-type)){border-block-end-width:var(--calcite-border-width-sm)}.default-trigger{position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}slot[name=trigger]::slotted(calcite-action),calcite-action::slotted([slot=trigger]){position:relative;block-size:100%;flex:0 1 auto;align-self:stretch}.menu{display:flex;max-block-size:45vh;flex-direction:column;flex-wrap:nowrap;overflow-y:auto;overflow-x:hidden;outline:2px solid transparent;outline-offset:2px;gap:var(--calcite-action-menu-items-space, 0)}:host([hidden]){display:none}[hidden]{display:none}`;
const SUPPORTED_MENU_NAV_KEYS = ["ArrowUp", "ArrowDown", "End", "Home"];
class ActionMenu extends _arcgis_lumina__WEBPACK_IMPORTED_MODULE_3__.LitElement {
  constructor() {
    super(...arguments);
    this.guid = (0,_chunks_guid_js__WEBPACK_IMPORTED_MODULE_6__.g)();
    this.actionElements = [];
    this.menuButtonClick = () => {
      this.toggleOpen();
    };
    this.menuButtonId = _chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.I.button(this.guid);
    this.menuButtonKeyDown = (event) => {
      const { key } = event;
      const { actionElements, activeMenuItemIndex, open } = this;
      if (!actionElements.length) {
        return;
      }
      if ((0,_chunks_key_js__WEBPACK_IMPORTED_MODULE_7__.i)(key)) {
        event.preventDefault();
        if (!open) {
          this.toggleOpen();
          return;
        }
        const action = actionElements[activeMenuItemIndex];
        if (action) {
          action.click();
        } else {
          this.toggleOpen(false);
        }
      }
      if (key === "Tab") {
        this.open = false;
        return;
      }
      if (key === "Escape") {
        this.toggleOpen(false);
        event.preventDefault();
        return;
      }
      this.handleActionNavigation(event, key, actionElements);
    };
    this.menuId = _chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.I.menu(this.guid);
    this._open = false;
    this.updateAction = (action, index) => {
      const { guid: guid2, activeMenuItemIndex } = this;
      const id = _chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.I.action(guid2, index);
      action.tabIndex = -1;
      action.setAttribute("role", "menuitem");
      if (!action.id) {
        action.id = id;
      }
      action.activeDescendant = index === activeMenuItemIndex;
    };
    this.focusSetter = (0,_chunks_useSetFocus_js__WEBPACK_IMPORTED_MODULE_8__.u)()(this);
    this.activeMenuItemIndex = -1;
    this.appearance = "solid";
    this.expanded = false;
    this.overlayPositioning = "absolute";
    this.placement = "auto";
    this.scale = "m";
    this.calciteActionMenuCollapse = (0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_3__.createEvent)({ cancelable: false });
    this.calciteActionMenuExpand = (0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_3__.createEvent)({ cancelable: false });
    this.calciteActionMenuOpen = (0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_3__.createEvent)({ cancelable: false });
  }
  static {
    this.properties = { activeMenuItemIndex: [16, {}, { state: true }], menuButtonEl: [16, {}, { state: true }], appearance: [3, {}, { reflect: true }], expanded: [7, {}, { reflect: true, type: Boolean }], flipPlacements: [0, {}, { attribute: false }], label: 1, open: [7, {}, { reflect: true, type: Boolean }], overlayPositioning: [3, {}, { reflect: true }], placement: [3, {}, { reflect: true }], scale: [3, {}, { reflect: true }] };
  }
  static {
    this.styles = styles;
  }
  get open() {
    return this._open;
  }
  set open(open) {
    const oldOpen = this._open;
    if (open !== oldOpen) {
      this._open = open;
      this.openHandler(open);
    }
  }
  async setFocus(options) {
    return this.focusSetter(() => this.menuButtonEl, options);
  }
  connectedCallback() {
    super.connectedCallback();
    this.connectMenuButtonEl();
  }
  willUpdate(changes) {
    if (changes.has("expanded") && (this.hasUpdated || this.expanded !== false)) {
      this.expandedHandler();
    }
    if (changes.has("activeMenuItemIndex") && (this.hasUpdated || this.activeMenuItemIndex !== -1)) {
      this.updateActions(this.actionElements);
    }
    if (changes.has("expanded") && this.hasUpdated) {
      if (this.expanded) {
        this.calciteActionMenuExpand.emit();
      } else {
        this.calciteActionMenuCollapse.emit();
      }
    }
  }
  disconnectedCallback() {
    super.disconnectedCallback();
    this.disconnectMenuButtonEl();
  }
  expandedHandler() {
    this.open = false;
    this.setTooltipReferenceElement();
  }
  openHandler(open) {
    if (this.menuButtonEl) {
      this.menuButtonEl.active = open;
      this.menuButtonEl.aria = {
        expanded: open
      };
    }
    if (this.popoverEl) {
      this.popoverEl.open = open;
    }
    this.activeMenuItemIndex = this.open ? 0 : -1;
    this.calciteActionMenuOpen.emit();
    this.setTooltipReferenceElement();
  }
  connectMenuButtonEl() {
    const { menuButtonId, menuId, open, label } = this;
    const menuButtonEl = this.slottedMenuButtonEl || this.defaultMenuButtonEl;
    if (this.menuButtonEl === menuButtonEl) {
      return;
    }
    this.disconnectMenuButtonEl();
    this.menuButtonEl = menuButtonEl;
    this.setTooltipReferenceElement();
    if (!menuButtonEl) {
      return;
    }
    menuButtonEl.active = open;
    menuButtonEl.setAttribute("aria-controls", menuId);
    menuButtonEl.setAttribute("aria-expanded", (0,_chunks_dom_js__WEBPACK_IMPORTED_MODULE_5__.t)(open));
    menuButtonEl.setAttribute("aria-haspopup", "true");
    if (!menuButtonEl.id) {
      menuButtonEl.id = menuButtonId;
    }
    if (!menuButtonEl.label) {
      menuButtonEl.label = label;
    }
    if (!menuButtonEl.text) {
      menuButtonEl.text = label;
    }
    menuButtonEl.addEventListener("click", this.menuButtonClick);
    menuButtonEl.addEventListener("keydown", this.menuButtonKeyDown);
  }
  disconnectMenuButtonEl() {
    const { menuButtonEl } = this;
    if (!menuButtonEl) {
      return;
    }
    menuButtonEl.removeEventListener("click", this.menuButtonClick);
    menuButtonEl.removeEventListener("keydown", this.menuButtonKeyDown);
    this.menuButtonEl = null;
  }
  setMenuButtonEl(event) {
    const actions = event.target.assignedElements({
      flatten: true
    }).filter((el) => el?.matches("calcite-action"));
    this.slottedMenuButtonEl = actions[0];
    this.connectMenuButtonEl();
  }
  setDefaultMenuButtonEl(el) {
    this.defaultMenuButtonEl = el;
    this.connectMenuButtonEl();
  }
  setPopoverEl(el) {
    if (!el) {
      return;
    }
    this.popoverEl = el;
    el.open = this.open;
  }
  handleCalciteActionClick() {
    this.open = false;
    this.setFocus();
  }
  updateTooltip(event) {
    const tooltips = event.target.assignedElements({
      flatten: true
    }).filter((el) => el?.matches("calcite-tooltip"));
    this.tooltipEl = tooltips[0];
    this.setTooltipReferenceElement();
  }
  setTooltipReferenceElement() {
    const { tooltipEl, expanded, menuButtonEl, open } = this;
    if (tooltipEl) {
      tooltipEl.referenceElement = !expanded && !open ? menuButtonEl : null;
    }
  }
  updateActions(actions) {
    actions?.forEach(this.updateAction);
  }
  async handleDefaultSlotChange(event) {
    const actions = event.target.assignedElements({
      flatten: true
    }).reduce((previousValue, currentValue) => {
      if (currentValue?.matches("calcite-action")) {
        previousValue.push(currentValue);
        return previousValue;
      }
      if (currentValue?.matches("calcite-action-group")) {
        return previousValue.concat(Array.from(currentValue.querySelectorAll("calcite-action")));
      }
      return previousValue;
    }, []);
    await this.componentOnReady();
    this.actionElements = actions.filter((action) => !action.disabled && !action.hidden);
  }
  isValidKey(key, supportedKeys) {
    return !!supportedKeys.find((k) => k === key);
  }
  handleActionNavigation(event, key, actions) {
    if (!this.isValidKey(key, SUPPORTED_MENU_NAV_KEYS)) {
      return;
    }
    event.preventDefault();
    if (!this.open) {
      this.toggleOpen();
      if (key === "Home" || key === "ArrowDown") {
        this.activeMenuItemIndex = 0;
      }
      if (key === "End" || key === "ArrowUp") {
        this.activeMenuItemIndex = actions.length - 1;
      }
      return;
    }
    if (key === "Home") {
      this.activeMenuItemIndex = 0;
    }
    if (key === "End") {
      this.activeMenuItemIndex = actions.length - 1;
    }
    const currentIndex = this.activeMenuItemIndex;
    if (key === "ArrowUp") {
      this.activeMenuItemIndex = (0,_chunks_array_js__WEBPACK_IMPORTED_MODULE_4__.g)(Math.max(currentIndex - 1, -1), actions.length);
    }
    if (key === "ArrowDown") {
      this.activeMenuItemIndex = (0,_chunks_array_js__WEBPACK_IMPORTED_MODULE_4__.g)(currentIndex + 1, actions.length);
    }
  }
  toggleOpen(value = !this.open) {
    this.open = value;
  }
  handlePopoverOpen(event) {
    event.stopPropagation();
    this.open = true;
    this.setFocus();
  }
  handlePopoverClose(event) {
    event.stopPropagation();
    this.open = false;
  }
  renderMenuButton() {
    const { appearance, label, scale, expanded } = this;
    const menuButtonSlot = (0,lit__WEBPACK_IMPORTED_MODULE_2__.html)`<slot name=${_chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.S.trigger} @slotchange=${this.setMenuButtonEl}><calcite-action .appearance=${appearance} .aria=${{ expanded }} class=${(0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_3__.safeClassMap)(_chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.C.defaultTrigger)} .icon=${_chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.a.menu} .scale=${scale} .text=${label} .textEnabled=${expanded} ${(0,lit_directives_ref_js__WEBPACK_IMPORTED_MODULE_1__.ref)(this.setDefaultMenuButtonEl)}></calcite-action></slot>`;
    return menuButtonSlot;
  }
  renderMenuItems() {
    const { actionElements, activeMenuItemIndex, menuId, menuButtonEl, label, placement, overlayPositioning, flipPlacements } = this;
    const activeAction = actionElements[activeMenuItemIndex];
    const activeDescendantId = activeAction?.id || null;
    return (0,lit__WEBPACK_IMPORTED_MODULE_2__.html)`<calcite-popover auto-close .flipPlacements=${flipPlacements} focus-trap-disabled .label=${label} offset-distance=0 @calcitePopoverClose=${this.handlePopoverClose} @calcitePopoverOpen=${this.handlePopoverOpen} .overlayPositioning=${overlayPositioning} .placement=${placement} pointer-disabled .referenceElement=${menuButtonEl} trigger-disabled ${(0,lit_directives_ref_js__WEBPACK_IMPORTED_MODULE_1__.ref)(this.setPopoverEl)}><div aria-activedescendant=${activeDescendantId ?? lit__WEBPACK_IMPORTED_MODULE_2__.nothing} aria-labelledby=${menuButtonEl?.id ?? lit__WEBPACK_IMPORTED_MODULE_2__.nothing} class=${(0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_3__.safeClassMap)(_chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.C.menu)} id=${menuId ?? lit__WEBPACK_IMPORTED_MODULE_2__.nothing} @click=${this.handleCalciteActionClick} role=menu tabindex=-1><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></calcite-popover>`;
  }
  render() {
    return (0,lit__WEBPACK_IMPORTED_MODULE_2__.html)`${this.renderMenuButton()}${this.renderMenuItems()}<slot name=${_chunks_resources2_js__WEBPACK_IMPORTED_MODULE_9__.S.tooltip} @slotchange=${this.updateTooltip}></slot>`;
  }
}
(0,_chunks_runtime_js__WEBPACK_IMPORTED_MODULE_0__.c)("calcite-action-menu", ActionMenu);



/***/ }),

/***/ "./node_modules/@esri/calcite-components/dist/components/calcite-action-menu/index.js":
/*!********************************************************************************************!*\
  !*** ./node_modules/@esri/calcite-components/dist/components/calcite-action-menu/index.js ***!
  \********************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ActionMenu: () => (/* reexport safe */ _customElement_js__WEBPACK_IMPORTED_MODULE_2__.ActionMenu)
/* harmony export */ });
/* harmony import */ var _calcite_action_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../calcite-action/index.js */ "./node_modules/@esri/calcite-components/dist/components/calcite-action/index.js");
/* harmony import */ var _calcite_popover_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../calcite-popover/index.js */ "./node_modules/@esri/calcite-components/dist/components/calcite-popover/index.js");
/* harmony import */ var _customElement_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./customElement.js */ "./node_modules/@esri/calcite-components/dist/components/calcite-action-menu/customElement.js");




/***/ })

};

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfZXNyaV9jYWxjaXRlLWNvbXBvbmVudHNfZGlzdF9jb21wb25lbnRzX2NhbGNpdGUtYWN0aW9uLW1lbnVfaW5kZXhfanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHRTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDUkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLFNBQVMsR0FBRyxHQUFHO0FBQ3BDLG1CQUFtQixTQUFTLEdBQUcsR0FBRztBQUNsQywrQkFBK0IsU0FBUyxHQUFHLEdBQUcsVUFBVSxTQUFTO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3pCRjtBQUNBO0FBQ0E7QUFDNkQ7QUFDakI7QUFDSDtBQUM4QjtBQUNQO0FBQ1A7QUFDUjtBQUNVO0FBQ0k7QUFDeUI7QUFDeEYsZUFBZSx3Q0FBRyxPQUFPLHdIQUF3SCxNQUFNLHNCQUFzQixhQUFhLHNCQUFzQixxQ0FBcUMsbURBQW1ELHNEQUFzRCxpQkFBaUIsa0JBQWtCLGdCQUFnQixjQUFjLG1CQUFtQixvRkFBb0Ysa0JBQWtCLGdCQUFnQixjQUFjLG1CQUFtQixNQUFNLGFBQWEsb0JBQW9CLHNCQUFzQixpQkFBaUIsZ0JBQWdCLGtCQUFrQiw4QkFBOEIsbUJBQW1CLDhDQUE4QyxnQkFBZ0IsYUFBYSxTQUFTLGFBQWE7QUFDMzBCO0FBQ0EseUJBQXlCLHNEQUFVO0FBQ25DO0FBQ0E7QUFDQSxnQkFBZ0Isa0RBQUk7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isb0RBQUc7QUFDM0I7QUFDQSxjQUFjLE1BQU07QUFDcEIsY0FBYyw0Q0FBNEM7QUFDMUQ7QUFDQTtBQUNBO0FBQ0EsVUFBVSxpREFBZTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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OUg7QUFDQTtBQUNBLFdBQVcseUNBQUksK0NBQStDLGdCQUFnQiw2QkFBNkIsT0FBTyx5Q0FBeUMseUJBQXlCLHNCQUFzQix3QkFBd0Isc0JBQXNCLG9CQUFvQixhQUFhLFdBQVcscUNBQXFDLGNBQWMsbUJBQW1CLDBEQUFHLG9CQUFvQiw4QkFBOEIsc0JBQXNCLHdDQUFPLEVBQUUsa0JBQWtCLG9CQUFvQix3Q0FBTyxFQUFFLFFBQVEsNERBQVksQ0FBQyxvREFBRyxRQUFRLEtBQUssVUFBVSx3Q0FBTyxFQUFFLFNBQVMsK0JBQStCLDBDQUEwQyw2QkFBNkI7QUFDcHBCO0FBQ0E7QUFDQSxXQUFXLHlDQUFJLEdBQUcsd0JBQXdCLEVBQUUsdUJBQXVCLGFBQWEsb0RBQUssVUFBVSxjQUFjLG1CQUFtQjtBQUNoSTtBQUNBO0FBQ0EscURBQWE7QUFHWDs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbFNrQztBQUNDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJlY2lzaW9uZmFybXMvLi9ub2RlX21vZHVsZXMvQGVzcmkvY2FsY2l0ZS1jb21wb25lbnRzL2Rpc3QvY2h1bmtzL2FycmF5LmpzIiwid2VicGFjazovL3ByZWNpc2lvbmZhcm1zLy4vbm9kZV9tb2R1bGVzL0Blc3JpL2NhbGNpdGUtY29tcG9uZW50cy9kaXN0L2NodW5rcy9yZXNvdXJjZXMyLmpzIiwid2VicGFjazovL3ByZWNpc2lvbmZhcm1zLy4vbm9kZV9tb2R1bGVzL0Blc3JpL2NhbGNpdGUtY29tcG9uZW50cy9kaXN0L2NvbXBvbmVudHMvY2FsY2l0ZS1hY3Rpb24tbWVudS9jdXN0b21FbGVtZW50LmpzIiwid2VicGFjazovL3ByZWNpc2lvbmZhcm1zLy4vbm9kZV9tb2R1bGVzL0Blc3JpL2NhbGNpdGUtY29tcG9uZW50cy9kaXN0L2NvbXBvbmVudHMvY2FsY2l0ZS1hY3Rpb24tbWVudS9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFU1JJLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cblNlZSBodHRwczovL2dpdGh1Yi5jb20vRXNyaS9jYWxjaXRlLWRlc2lnbi1zeXN0ZW0vYmxvYi9kZXYvTElDRU5TRS5tZCBmb3IgZGV0YWlscy5cbnYzLjMuMyAqL1xuZnVuY3Rpb24gZ2V0Um91bmRSb2JpbkluZGV4KGluZGV4LCB0b3RhbCkge1xuICByZXR1cm4gKGluZGV4ICsgdG90YWwpICUgdG90YWw7XG59XG5leHBvcnQge1xuICBnZXRSb3VuZFJvYmluSW5kZXggYXMgZ1xufTtcbiIsIi8qISBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9Fc3JpL2NhbGNpdGUtZGVzaWduLXN5c3RlbS9ibG9iL2Rldi9MSUNFTlNFLm1kIGZvciBkZXRhaWxzLlxudjMuMy4zICovXG5jb25zdCBDU1MgPSB7XG4gIG1lbnU6IFwibWVudVwiLFxuICBkZWZhdWx0VHJpZ2dlcjogXCJkZWZhdWx0LXRyaWdnZXJcIlxufTtcbmNvbnN0IGlkUHJlZml4ID0gXCJjYWxjaXRlLWFjdGlvbi1tZW51XCI7XG5jb25zdCBJRFMgPSB7XG4gIGJ1dHRvbjogKGlkKSA9PiBgJHtpZFByZWZpeH0tJHtpZH0tbWVudS1idXR0b25gLFxuICBtZW51OiAoaWQpID0+IGAke2lkUHJlZml4fS0ke2lkfS1tZW51YCxcbiAgYWN0aW9uOiAoaWQsIGFjdGlvbklkKSA9PiBgJHtpZFByZWZpeH0tJHtpZH0tYWN0aW9uLSR7YWN0aW9uSWR9YFxufTtcbmNvbnN0IFNMT1RTID0ge1xuICB0b29sdGlwOiBcInRvb2x0aXBcIixcbiAgdHJpZ2dlcjogXCJ0cmlnZ2VyXCJcbn07XG5jb25zdCBJQ09OUyA9IHtcbiAgbWVudTogXCJlbGxpcHNpc1wiXG59O1xuZXhwb3J0IHtcbiAgQ1NTIGFzIEMsXG4gIElEUyBhcyBJLFxuICBTTE9UUyBhcyBTLFxuICBJQ09OUyBhcyBhXG59O1xuIiwiLyohIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRVNSSSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG5TZWUgaHR0cHM6Ly9naXRodWIuY29tL0VzcmkvY2FsY2l0ZS1kZXNpZ24tc3lzdGVtL2Jsb2IvZGV2L0xJQ0VOU0UubWQgZm9yIGRldGFpbHMuXG52My4zLjMgKi9cbmltcG9ydCB7IGMgYXMgY3VzdG9tRWxlbWVudCB9IGZyb20gXCIuLi8uLi9jaHVua3MvcnVudGltZS5qc1wiO1xuaW1wb3J0IHsgcmVmIH0gZnJvbSBcImxpdC9kaXJlY3RpdmVzL3JlZi5qc1wiO1xuaW1wb3J0IHsgY3NzLCBodG1sLCBub3RoaW5nIH0gZnJvbSBcImxpdFwiO1xuaW1wb3J0IHsgTGl0RWxlbWVudCwgY3JlYXRlRXZlbnQsIHNhZmVDbGFzc01hcCB9IGZyb20gXCJAYXJjZ2lzL2x1bWluYVwiO1xuaW1wb3J0IHsgZyBhcyBnZXRSb3VuZFJvYmluSW5kZXggfSBmcm9tIFwiLi4vLi4vY2h1bmtzL2FycmF5LmpzXCI7XG5pbXBvcnQgeyB0IGFzIHRvQXJpYUJvb2xlYW4gfSBmcm9tIFwiLi4vLi4vY2h1bmtzL2RvbS5qc1wiO1xuaW1wb3J0IHsgZyBhcyBndWlkIH0gZnJvbSBcIi4uLy4uL2NodW5rcy9ndWlkLmpzXCI7XG5pbXBvcnQgeyBpIGFzIGlzQWN0aXZhdGlvbktleSB9IGZyb20gXCIuLi8uLi9jaHVua3Mva2V5LmpzXCI7XG5pbXBvcnQgeyB1IGFzIHVzZVNldEZvY3VzIH0gZnJvbSBcIi4uLy4uL2NodW5rcy91c2VTZXRGb2N1cy5qc1wiO1xuaW1wb3J0IHsgSSBhcyBJRFMsIFMgYXMgU0xPVFMsIGEgYXMgSUNPTlMsIEMgYXMgQ1NTIH0gZnJvbSBcIi4uLy4uL2NodW5rcy9yZXNvdXJjZXMyLmpzXCI7XG5jb25zdCBzdHlsZXMgPSBjc3NgOmhvc3R7LS1jYWxjaXRlLWludGVybmFsLWNvbG9yLWZvY3VzOiB2YXIoIC0tY2FsY2l0ZS1jb2xvci1mb2N1cywgdmFyKC0tY2FsY2l0ZS11aS1mb2N1cy1jb2xvciwgdmFyKC0tY2FsY2l0ZS1jb2xvci1icmFuZCkpICl9Omhvc3R7Ym94LXNpemluZzpib3JkZXItYm94O2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Zm9udC1zaXplOnZhcigtLWNhbGNpdGUtZm9udC1zaXplLTEpfTo6c2xvdHRlZChjYWxjaXRlLWFjdGlvbi1ncm91cDpub3QoOmxhc3Qtb2YtdHlwZSkpe2JvcmRlci1ibG9jay1lbmQtd2lkdGg6dmFyKC0tY2FsY2l0ZS1ib3JkZXItd2lkdGgtc20pfS5kZWZhdWx0LXRyaWdnZXJ7cG9zaXRpb246cmVsYXRpdmU7YmxvY2stc2l6ZToxMDAlO2ZsZXg6MCAxIGF1dG87YWxpZ24tc2VsZjpzdHJldGNofXNsb3RbbmFtZT10cmlnZ2VyXTo6c2xvdHRlZChjYWxjaXRlLWFjdGlvbiksY2FsY2l0ZS1hY3Rpb246OnNsb3R0ZWQoW3Nsb3Q9dHJpZ2dlcl0pe3Bvc2l0aW9uOnJlbGF0aXZlO2Jsb2NrLXNpemU6MTAwJTtmbGV4OjAgMSBhdXRvO2FsaWduLXNlbGY6c3RyZXRjaH0ubWVudXtkaXNwbGF5OmZsZXg7bWF4LWJsb2NrLXNpemU6NDV2aDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47ZmxleC13cmFwOm5vd3JhcDtvdmVyZmxvdy15OmF1dG87b3ZlcmZsb3cteDpoaWRkZW47b3V0bGluZToycHggc29saWQgdHJhbnNwYXJlbnQ7b3V0bGluZS1vZmZzZXQ6MnB4O2dhcDp2YXIoLS1jYWxjaXRlLWFjdGlvbi1tZW51LWl0ZW1zLXNwYWNlLCAwKX06aG9zdChbaGlkZGVuXSl7ZGlzcGxheTpub25lfVtoaWRkZW5de2Rpc3BsYXk6bm9uZX1gO1xuY29uc3QgU1VQUE9SVEVEX01FTlVfTkFWX0tFWVMgPSBbXCJBcnJvd1VwXCIsIFwiQXJyb3dEb3duXCIsIFwiRW5kXCIsIFwiSG9tZVwiXTtcbmNsYXNzIEFjdGlvbk1lbnUgZXh0ZW5kcyBMaXRFbGVtZW50IHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICB0aGlzLmd1aWQgPSBndWlkKCk7XG4gICAgdGhpcy5hY3Rpb25FbGVtZW50cyA9IFtdO1xuICAgIHRoaXMubWVudUJ1dHRvbkNsaWNrID0gKCkgPT4ge1xuICAgICAgdGhpcy50b2dnbGVPcGVuKCk7XG4gICAgfTtcbiAgICB0aGlzLm1lbnVCdXR0b25JZCA9IElEUy5idXR0b24odGhpcy5ndWlkKTtcbiAgICB0aGlzLm1lbnVCdXR0b25LZXlEb3duID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IGtleSB9ID0gZXZlbnQ7XG4gICAgICBjb25zdCB7IGFjdGlvbkVsZW1lbnRzLCBhY3RpdmVNZW51SXRlbUluZGV4LCBvcGVuIH0gPSB0aGlzO1xuICAgICAgaWYgKCFhY3Rpb25FbGVtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGlzQWN0aXZhdGlvbktleShrZXkpKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICghb3Blbikge1xuICAgICAgICAgIHRoaXMudG9nZ2xlT3BlbigpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhY3Rpb24gPSBhY3Rpb25FbGVtZW50c1thY3RpdmVNZW51SXRlbUluZGV4XTtcbiAgICAgICAgaWYgKGFjdGlvbikge1xuICAgICAgICAgIGFjdGlvbi5jbGljaygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMudG9nZ2xlT3BlbihmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09IFwiVGFiXCIpIHtcbiAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgICAgdGhpcy50b2dnbGVPcGVuKGZhbHNlKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5oYW5kbGVBY3Rpb25OYXZpZ2F0aW9uKGV2ZW50LCBrZXksIGFjdGlvbkVsZW1lbnRzKTtcbiAgICB9O1xuICAgIHRoaXMubWVudUlkID0gSURTLm1lbnUodGhpcy5ndWlkKTtcbiAgICB0aGlzLl9vcGVuID0gZmFsc2U7XG4gICAgdGhpcy51cGRhdGVBY3Rpb24gPSAoYWN0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgeyBndWlkOiBndWlkMiwgYWN0aXZlTWVudUl0ZW1JbmRleCB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGlkID0gSURTLmFjdGlvbihndWlkMiwgaW5kZXgpO1xuICAgICAgYWN0aW9uLnRhYkluZGV4ID0gLTE7XG4gICAgICBhY3Rpb24uc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcIm1lbnVpdGVtXCIpO1xuICAgICAgaWYgKCFhY3Rpb24uaWQpIHtcbiAgICAgICAgYWN0aW9uLmlkID0gaWQ7XG4gICAgICB9XG4gICAgICBhY3Rpb24uYWN0aXZlRGVzY2VuZGFudCA9IGluZGV4ID09PSBhY3RpdmVNZW51SXRlbUluZGV4O1xuICAgIH07XG4gICAgdGhpcy5mb2N1c1NldHRlciA9IHVzZVNldEZvY3VzKCkodGhpcyk7XG4gICAgdGhpcy5hY3RpdmVNZW51SXRlbUluZGV4ID0gLTE7XG4gICAgdGhpcy5hcHBlYXJhbmNlID0gXCJzb2xpZFwiO1xuICAgIHRoaXMuZXhwYW5kZWQgPSBmYWxzZTtcbiAgICB0aGlzLm92ZXJsYXlQb3NpdGlvbmluZyA9IFwiYWJzb2x1dGVcIjtcbiAgICB0aGlzLnBsYWNlbWVudCA9IFwiYXV0b1wiO1xuICAgIHRoaXMuc2NhbGUgPSBcIm1cIjtcbiAgICB0aGlzLmNhbGNpdGVBY3Rpb25NZW51Q29sbGFwc2UgPSBjcmVhdGVFdmVudCh7IGNhbmNlbGFibGU6IGZhbHNlIH0pO1xuICAgIHRoaXMuY2FsY2l0ZUFjdGlvbk1lbnVFeHBhbmQgPSBjcmVhdGVFdmVudCh7IGNhbmNlbGFibGU6IGZhbHNlIH0pO1xuICAgIHRoaXMuY2FsY2l0ZUFjdGlvbk1lbnVPcGVuID0gY3JlYXRlRXZlbnQoeyBjYW5jZWxhYmxlOiBmYWxzZSB9KTtcbiAgfVxuICBzdGF0aWMge1xuICAgIHRoaXMucHJvcGVydGllcyA9IHsgYWN0aXZlTWVudUl0ZW1JbmRleDogWzE2LCB7fSwgeyBzdGF0ZTogdHJ1ZSB9XSwgbWVudUJ1dHRvbkVsOiBbMTYsIHt9LCB7IHN0YXRlOiB0cnVlIH1dLCBhcHBlYXJhbmNlOiBbMywge30sIHsgcmVmbGVjdDogdHJ1ZSB9XSwgZXhwYW5kZWQ6IFs3LCB7fSwgeyByZWZsZWN0OiB0cnVlLCB0eXBlOiBCb29sZWFuIH1dLCBmbGlwUGxhY2VtZW50czogWzAsIHt9LCB7IGF0dHJpYnV0ZTogZmFsc2UgfV0sIGxhYmVsOiAxLCBvcGVuOiBbNywge30sIHsgcmVmbGVjdDogdHJ1ZSwgdHlwZTogQm9vbGVhbiB9XSwgb3ZlcmxheVBvc2l0aW9uaW5nOiBbMywge30sIHsgcmVmbGVjdDogdHJ1ZSB9XSwgcGxhY2VtZW50OiBbMywge30sIHsgcmVmbGVjdDogdHJ1ZSB9XSwgc2NhbGU6IFszLCB7fSwgeyByZWZsZWN0OiB0cnVlIH1dIH07XG4gIH1cbiAgc3RhdGljIHtcbiAgICB0aGlzLnN0eWxlcyA9IHN0eWxlcztcbiAgfVxuICBnZXQgb3BlbigpIHtcbiAgICByZXR1cm4gdGhpcy5fb3BlbjtcbiAgfVxuICBzZXQgb3BlbihvcGVuKSB7XG4gICAgY29uc3Qgb2xkT3BlbiA9IHRoaXMuX29wZW47XG4gICAgaWYgKG9wZW4gIT09IG9sZE9wZW4pIHtcbiAgICAgIHRoaXMuX29wZW4gPSBvcGVuO1xuICAgICAgdGhpcy5vcGVuSGFuZGxlcihvcGVuKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgc2V0Rm9jdXMob3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLmZvY3VzU2V0dGVyKCgpID0+IHRoaXMubWVudUJ1dHRvbkVsLCBvcHRpb25zKTtcbiAgfVxuICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICBzdXBlci5jb25uZWN0ZWRDYWxsYmFjaygpO1xuICAgIHRoaXMuY29ubmVjdE1lbnVCdXR0b25FbCgpO1xuICB9XG4gIHdpbGxVcGRhdGUoY2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzLmhhcyhcImV4cGFuZGVkXCIpICYmICh0aGlzLmhhc1VwZGF0ZWQgfHwgdGhpcy5leHBhbmRlZCAhPT0gZmFsc2UpKSB7XG4gICAgICB0aGlzLmV4cGFuZGVkSGFuZGxlcigpO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlcy5oYXMoXCJhY3RpdmVNZW51SXRlbUluZGV4XCIpICYmICh0aGlzLmhhc1VwZGF0ZWQgfHwgdGhpcy5hY3RpdmVNZW51SXRlbUluZGV4ICE9PSAtMSkpIHtcbiAgICAgIHRoaXMudXBkYXRlQWN0aW9ucyh0aGlzLmFjdGlvbkVsZW1lbnRzKTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXMuaGFzKFwiZXhwYW5kZWRcIikgJiYgdGhpcy5oYXNVcGRhdGVkKSB7XG4gICAgICBpZiAodGhpcy5leHBhbmRlZCkge1xuICAgICAgICB0aGlzLmNhbGNpdGVBY3Rpb25NZW51RXhwYW5kLmVtaXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2FsY2l0ZUFjdGlvbk1lbnVDb2xsYXBzZS5lbWl0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgIHN1cGVyLmRpc2Nvbm5lY3RlZENhbGxiYWNrKCk7XG4gICAgdGhpcy5kaXNjb25uZWN0TWVudUJ1dHRvbkVsKCk7XG4gIH1cbiAgZXhwYW5kZWRIYW5kbGVyKCkge1xuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuc2V0VG9vbHRpcFJlZmVyZW5jZUVsZW1lbnQoKTtcbiAgfVxuICBvcGVuSGFuZGxlcihvcGVuKSB7XG4gICAgaWYgKHRoaXMubWVudUJ1dHRvbkVsKSB7XG4gICAgICB0aGlzLm1lbnVCdXR0b25FbC5hY3RpdmUgPSBvcGVuO1xuICAgICAgdGhpcy5tZW51QnV0dG9uRWwuYXJpYSA9IHtcbiAgICAgICAgZXhwYW5kZWQ6IG9wZW5cbiAgICAgIH07XG4gICAgfVxuICAgIGlmICh0aGlzLnBvcG92ZXJFbCkge1xuICAgICAgdGhpcy5wb3BvdmVyRWwub3BlbiA9IG9wZW47XG4gICAgfVxuICAgIHRoaXMuYWN0aXZlTWVudUl0ZW1JbmRleCA9IHRoaXMub3BlbiA/IDAgOiAtMTtcbiAgICB0aGlzLmNhbGNpdGVBY3Rpb25NZW51T3Blbi5lbWl0KCk7XG4gICAgdGhpcy5zZXRUb29sdGlwUmVmZXJlbmNlRWxlbWVudCgpO1xuICB9XG4gIGNvbm5lY3RNZW51QnV0dG9uRWwoKSB7XG4gICAgY29uc3QgeyBtZW51QnV0dG9uSWQsIG1lbnVJZCwgb3BlbiwgbGFiZWwgfSA9IHRoaXM7XG4gICAgY29uc3QgbWVudUJ1dHRvbkVsID0gdGhpcy5zbG90dGVkTWVudUJ1dHRvbkVsIHx8IHRoaXMuZGVmYXVsdE1lbnVCdXR0b25FbDtcbiAgICBpZiAodGhpcy5tZW51QnV0dG9uRWwgPT09IG1lbnVCdXR0b25FbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmRpc2Nvbm5lY3RNZW51QnV0dG9uRWwoKTtcbiAgICB0aGlzLm1lbnVCdXR0b25FbCA9IG1lbnVCdXR0b25FbDtcbiAgICB0aGlzLnNldFRvb2x0aXBSZWZlcmVuY2VFbGVtZW50KCk7XG4gICAgaWYgKCFtZW51QnV0dG9uRWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbWVudUJ1dHRvbkVsLmFjdGl2ZSA9IG9wZW47XG4gICAgbWVudUJ1dHRvbkVsLnNldEF0dHJpYnV0ZShcImFyaWEtY29udHJvbHNcIiwgbWVudUlkKTtcbiAgICBtZW51QnV0dG9uRWwuc2V0QXR0cmlidXRlKFwiYXJpYS1leHBhbmRlZFwiLCB0b0FyaWFCb29sZWFuKG9wZW4pKTtcbiAgICBtZW51QnV0dG9uRWwuc2V0QXR0cmlidXRlKFwiYXJpYS1oYXNwb3B1cFwiLCBcInRydWVcIik7XG4gICAgaWYgKCFtZW51QnV0dG9uRWwuaWQpIHtcbiAgICAgIG1lbnVCdXR0b25FbC5pZCA9IG1lbnVCdXR0b25JZDtcbiAgICB9XG4gICAgaWYgKCFtZW51QnV0dG9uRWwubGFiZWwpIHtcbiAgICAgIG1lbnVCdXR0b25FbC5sYWJlbCA9IGxhYmVsO1xuICAgIH1cbiAgICBpZiAoIW1lbnVCdXR0b25FbC50ZXh0KSB7XG4gICAgICBtZW51QnV0dG9uRWwudGV4dCA9IGxhYmVsO1xuICAgIH1cbiAgICBtZW51QnV0dG9uRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMubWVudUJ1dHRvbkNsaWNrKTtcbiAgICBtZW51QnV0dG9uRWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5tZW51QnV0dG9uS2V5RG93bik7XG4gIH1cbiAgZGlzY29ubmVjdE1lbnVCdXR0b25FbCgpIHtcbiAgICBjb25zdCB7IG1lbnVCdXR0b25FbCB9ID0gdGhpcztcbiAgICBpZiAoIW1lbnVCdXR0b25FbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBtZW51QnV0dG9uRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMubWVudUJ1dHRvbkNsaWNrKTtcbiAgICBtZW51QnV0dG9uRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5tZW51QnV0dG9uS2V5RG93bik7XG4gICAgdGhpcy5tZW51QnV0dG9uRWwgPSBudWxsO1xuICB9XG4gIHNldE1lbnVCdXR0b25FbChldmVudCkge1xuICAgIGNvbnN0IGFjdGlvbnMgPSBldmVudC50YXJnZXQuYXNzaWduZWRFbGVtZW50cyh7XG4gICAgICBmbGF0dGVuOiB0cnVlXG4gICAgfSkuZmlsdGVyKChlbCkgPT4gZWw/Lm1hdGNoZXMoXCJjYWxjaXRlLWFjdGlvblwiKSk7XG4gICAgdGhpcy5zbG90dGVkTWVudUJ1dHRvbkVsID0gYWN0aW9uc1swXTtcbiAgICB0aGlzLmNvbm5lY3RNZW51QnV0dG9uRWwoKTtcbiAgfVxuICBzZXREZWZhdWx0TWVudUJ1dHRvbkVsKGVsKSB7XG4gICAgdGhpcy5kZWZhdWx0TWVudUJ1dHRvbkVsID0gZWw7XG4gICAgdGhpcy5jb25uZWN0TWVudUJ1dHRvbkVsKCk7XG4gIH1cbiAgc2V0UG9wb3ZlckVsKGVsKSB7XG4gICAgaWYgKCFlbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnBvcG92ZXJFbCA9IGVsO1xuICAgIGVsLm9wZW4gPSB0aGlzLm9wZW47XG4gIH1cbiAgaGFuZGxlQ2FsY2l0ZUFjdGlvbkNsaWNrKCkge1xuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuc2V0Rm9jdXMoKTtcbiAgfVxuICB1cGRhdGVUb29sdGlwKGV2ZW50KSB7XG4gICAgY29uc3QgdG9vbHRpcHMgPSBldmVudC50YXJnZXQuYXNzaWduZWRFbGVtZW50cyh7XG4gICAgICBmbGF0dGVuOiB0cnVlXG4gICAgfSkuZmlsdGVyKChlbCkgPT4gZWw/Lm1hdGNoZXMoXCJjYWxjaXRlLXRvb2x0aXBcIikpO1xuICAgIHRoaXMudG9vbHRpcEVsID0gdG9vbHRpcHNbMF07XG4gICAgdGhpcy5zZXRUb29sdGlwUmVmZXJlbmNlRWxlbWVudCgpO1xuICB9XG4gIHNldFRvb2x0aXBSZWZlcmVuY2VFbGVtZW50KCkge1xuICAgIGNvbnN0IHsgdG9vbHRpcEVsLCBleHBhbmRlZCwgbWVudUJ1dHRvbkVsLCBvcGVuIH0gPSB0aGlzO1xuICAgIGlmICh0b29sdGlwRWwpIHtcbiAgICAgIHRvb2x0aXBFbC5yZWZlcmVuY2VFbGVtZW50ID0gIWV4cGFuZGVkICYmICFvcGVuID8gbWVudUJ1dHRvbkVsIDogbnVsbDtcbiAgICB9XG4gIH1cbiAgdXBkYXRlQWN0aW9ucyhhY3Rpb25zKSB7XG4gICAgYWN0aW9ucz8uZm9yRWFjaCh0aGlzLnVwZGF0ZUFjdGlvbik7XG4gIH1cbiAgYXN5bmMgaGFuZGxlRGVmYXVsdFNsb3RDaGFuZ2UoZXZlbnQpIHtcbiAgICBjb25zdCBhY3Rpb25zID0gZXZlbnQudGFyZ2V0LmFzc2lnbmVkRWxlbWVudHMoe1xuICAgICAgZmxhdHRlbjogdHJ1ZVxuICAgIH0pLnJlZHVjZSgocHJldmlvdXNWYWx1ZSwgY3VycmVudFZhbHVlKSA9PiB7XG4gICAgICBpZiAoY3VycmVudFZhbHVlPy5tYXRjaGVzKFwiY2FsY2l0ZS1hY3Rpb25cIikpIHtcbiAgICAgICAgcHJldmlvdXNWYWx1ZS5wdXNoKGN1cnJlbnRWYWx1ZSk7XG4gICAgICAgIHJldHVybiBwcmV2aW91c1ZhbHVlO1xuICAgICAgfVxuICAgICAgaWYgKGN1cnJlbnRWYWx1ZT8ubWF0Y2hlcyhcImNhbGNpdGUtYWN0aW9uLWdyb3VwXCIpKSB7XG4gICAgICAgIHJldHVybiBwcmV2aW91c1ZhbHVlLmNvbmNhdChBcnJheS5mcm9tKGN1cnJlbnRWYWx1ZS5xdWVyeVNlbGVjdG9yQWxsKFwiY2FsY2l0ZS1hY3Rpb25cIikpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcmV2aW91c1ZhbHVlO1xuICAgIH0sIFtdKTtcbiAgICBhd2FpdCB0aGlzLmNvbXBvbmVudE9uUmVhZHkoKTtcbiAgICB0aGlzLmFjdGlvbkVsZW1lbnRzID0gYWN0aW9ucy5maWx0ZXIoKGFjdGlvbikgPT4gIWFjdGlvbi5kaXNhYmxlZCAmJiAhYWN0aW9uLmhpZGRlbik7XG4gIH1cbiAgaXNWYWxpZEtleShrZXksIHN1cHBvcnRlZEtleXMpIHtcbiAgICByZXR1cm4gISFzdXBwb3J0ZWRLZXlzLmZpbmQoKGspID0+IGsgPT09IGtleSk7XG4gIH1cbiAgaGFuZGxlQWN0aW9uTmF2aWdhdGlvbihldmVudCwga2V5LCBhY3Rpb25zKSB7XG4gICAgaWYgKCF0aGlzLmlzVmFsaWRLZXkoa2V5LCBTVVBQT1JURURfTUVOVV9OQVZfS0VZUykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBpZiAoIXRoaXMub3Blbikge1xuICAgICAgdGhpcy50b2dnbGVPcGVuKCk7XG4gICAgICBpZiAoa2V5ID09PSBcIkhvbWVcIiB8fCBrZXkgPT09IFwiQXJyb3dEb3duXCIpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVNZW51SXRlbUluZGV4ID0gMDtcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09IFwiRW5kXCIgfHwga2V5ID09PSBcIkFycm93VXBcIikge1xuICAgICAgICB0aGlzLmFjdGl2ZU1lbnVJdGVtSW5kZXggPSBhY3Rpb25zLmxlbmd0aCAtIDE7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChrZXkgPT09IFwiSG9tZVwiKSB7XG4gICAgICB0aGlzLmFjdGl2ZU1lbnVJdGVtSW5kZXggPSAwO1xuICAgIH1cbiAgICBpZiAoa2V5ID09PSBcIkVuZFwiKSB7XG4gICAgICB0aGlzLmFjdGl2ZU1lbnVJdGVtSW5kZXggPSBhY3Rpb25zLmxlbmd0aCAtIDE7XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMuYWN0aXZlTWVudUl0ZW1JbmRleDtcbiAgICBpZiAoa2V5ID09PSBcIkFycm93VXBcIikge1xuICAgICAgdGhpcy5hY3RpdmVNZW51SXRlbUluZGV4ID0gZ2V0Um91bmRSb2JpbkluZGV4KE1hdGgubWF4KGN1cnJlbnRJbmRleCAtIDEsIC0xKSwgYWN0aW9ucy5sZW5ndGgpO1xuICAgIH1cbiAgICBpZiAoa2V5ID09PSBcIkFycm93RG93blwiKSB7XG4gICAgICB0aGlzLmFjdGl2ZU1lbnVJdGVtSW5kZXggPSBnZXRSb3VuZFJvYmluSW5kZXgoY3VycmVudEluZGV4ICsgMSwgYWN0aW9ucy5sZW5ndGgpO1xuICAgIH1cbiAgfVxuICB0b2dnbGVPcGVuKHZhbHVlID0gIXRoaXMub3Blbikge1xuICAgIHRoaXMub3BlbiA9IHZhbHVlO1xuICB9XG4gIGhhbmRsZVBvcG92ZXJPcGVuKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5vcGVuID0gdHJ1ZTtcbiAgICB0aGlzLnNldEZvY3VzKCk7XG4gIH1cbiAgaGFuZGxlUG9wb3ZlckNsb3NlKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gIH1cbiAgcmVuZGVyTWVudUJ1dHRvbigpIHtcbiAgICBjb25zdCB7IGFwcGVhcmFuY2UsIGxhYmVsLCBzY2FsZSwgZXhwYW5kZWQgfSA9IHRoaXM7XG4gICAgY29uc3QgbWVudUJ1dHRvblNsb3QgPSBodG1sYDxzbG90IG5hbWU9JHtTTE9UUy50cmlnZ2VyfSBAc2xvdGNoYW5nZT0ke3RoaXMuc2V0TWVudUJ1dHRvbkVsfT48Y2FsY2l0ZS1hY3Rpb24gLmFwcGVhcmFuY2U9JHthcHBlYXJhbmNlfSAuYXJpYT0ke3sgZXhwYW5kZWQgfX0gY2xhc3M9JHtzYWZlQ2xhc3NNYXAoQ1NTLmRlZmF1bHRUcmlnZ2VyKX0gLmljb249JHtJQ09OUy5tZW51fSAuc2NhbGU9JHtzY2FsZX0gLnRleHQ9JHtsYWJlbH0gLnRleHRFbmFibGVkPSR7ZXhwYW5kZWR9ICR7cmVmKHRoaXMuc2V0RGVmYXVsdE1lbnVCdXR0b25FbCl9PjwvY2FsY2l0ZS1hY3Rpb24+PC9zbG90PmA7XG4gICAgcmV0dXJuIG1lbnVCdXR0b25TbG90O1xuICB9XG4gIHJlbmRlck1lbnVJdGVtcygpIHtcbiAgICBjb25zdCB7IGFjdGlvbkVsZW1lbnRzLCBhY3RpdmVNZW51SXRlbUluZGV4LCBtZW51SWQsIG1lbnVCdXR0b25FbCwgbGFiZWwsIHBsYWNlbWVudCwgb3ZlcmxheVBvc2l0aW9uaW5nLCBmbGlwUGxhY2VtZW50cyB9ID0gdGhpcztcbiAgICBjb25zdCBhY3RpdmVBY3Rpb24gPSBhY3Rpb25FbGVtZW50c1thY3RpdmVNZW51SXRlbUluZGV4XTtcbiAgICBjb25zdCBhY3RpdmVEZXNjZW5kYW50SWQgPSBhY3RpdmVBY3Rpb24/LmlkIHx8IG51bGw7XG4gICAgcmV0dXJuIGh0bWxgPGNhbGNpdGUtcG9wb3ZlciBhdXRvLWNsb3NlIC5mbGlwUGxhY2VtZW50cz0ke2ZsaXBQbGFjZW1lbnRzfSBmb2N1cy10cmFwLWRpc2FibGVkIC5sYWJlbD0ke2xhYmVsfSBvZmZzZXQtZGlzdGFuY2U9MCBAY2FsY2l0ZVBvcG92ZXJDbG9zZT0ke3RoaXMuaGFuZGxlUG9wb3ZlckNsb3NlfSBAY2FsY2l0ZVBvcG92ZXJPcGVuPSR7dGhpcy5oYW5kbGVQb3BvdmVyT3Blbn0gLm92ZXJsYXlQb3NpdGlvbmluZz0ke292ZXJsYXlQb3NpdGlvbmluZ30gLnBsYWNlbWVudD0ke3BsYWNlbWVudH0gcG9pbnRlci1kaXNhYmxlZCAucmVmZXJlbmNlRWxlbWVudD0ke21lbnVCdXR0b25FbH0gdHJpZ2dlci1kaXNhYmxlZCAke3JlZih0aGlzLnNldFBvcG92ZXJFbCl9PjxkaXYgYXJpYS1hY3RpdmVkZXNjZW5kYW50PSR7YWN0aXZlRGVzY2VuZGFudElkID8/IG5vdGhpbmd9IGFyaWEtbGFiZWxsZWRieT0ke21lbnVCdXR0b25FbD8uaWQgPz8gbm90aGluZ30gY2xhc3M9JHtzYWZlQ2xhc3NNYXAoQ1NTLm1lbnUpfSBpZD0ke21lbnVJZCA/PyBub3RoaW5nfSBAY2xpY2s9JHt0aGlzLmhhbmRsZUNhbGNpdGVBY3Rpb25DbGlja30gcm9sZT1tZW51IHRhYmluZGV4PS0xPjxzbG90IEBzbG90Y2hhbmdlPSR7dGhpcy5oYW5kbGVEZWZhdWx0U2xvdENoYW5nZX0+PC9zbG90PjwvZGl2PjwvY2FsY2l0ZS1wb3BvdmVyPmA7XG4gIH1cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiBodG1sYCR7dGhpcy5yZW5kZXJNZW51QnV0dG9uKCl9JHt0aGlzLnJlbmRlck1lbnVJdGVtcygpfTxzbG90IG5hbWU9JHtTTE9UUy50b29sdGlwfSBAc2xvdGNoYW5nZT0ke3RoaXMudXBkYXRlVG9vbHRpcH0+PC9zbG90PmA7XG4gIH1cbn1cbmN1c3RvbUVsZW1lbnQoXCJjYWxjaXRlLWFjdGlvbi1tZW51XCIsIEFjdGlvbk1lbnUpO1xuZXhwb3J0IHtcbiAgQWN0aW9uTWVudVxufTtcbiIsImltcG9ydCBcIi4uL2NhbGNpdGUtYWN0aW9uL2luZGV4LmpzXCI7XG5pbXBvcnQgXCIuLi9jYWxjaXRlLXBvcG92ZXIvaW5kZXguanNcIjtcbmV4cG9ydCAqIGZyb20gXCIuL2N1c3RvbUVsZW1lbnQuanNcIjsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=